<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.unomas.mapper.NoticeMapper">

<resultMap type="NoticeVO" id="noticeMap">
	<id column="NOTICE_NUM" property="notice_num"/>
	<result column="ADMIN_NUM" property="admin_num"/>
	<result column="NOTICE_TITLE" property="notice_title"/>
	<result column="NOTICE_CONTENT" property="notice_content"/>
	<result column="NOTICE_REGDATE" property="notice_regdate"/>
	<result column="NOTICE_READCNT" property="notice_readcnt"/>
	<result column="NOTICE_IP" property="notice_ip"/>
	<result column="NOTICE_IMG" property="notice_img"/>
	<result column="NOTICE_FILE" property="notice_file"/>
	

	<association javaType="AdminVO" property="adminVO">
		<id column="ADMIN_NUM" property="admin_num"/>
		<result column="ADMIN_ID" property="admin_id"/>
		<result column="ADMIN_PASS" property="admin_pass"/>
		<result column="ADMIN_PERMIT" property="admin_permit"/>
		<result column="ADMIN_REGDATE" property="admin_regdate"/>
		<result column="ADMIN_LASTLOGIN" property="admin_lastlogin"/>
	</association>
</resultMap>

  <insert id="create">
		insert into board_notice(admin_num,notice_title,notice_content) 
		values(#{admin_num},#{notice_title},#{notice_content})
	</insert>
	
	<insert id="insert">
		insert into board_notice(admin_num,notice_title,notice_content,notice_file,notice_img,notice_ip)
		values (#{admin_num},#{notice_title},#{notice_content},#{notice_file},#{notice_img},#{notice_ip})
	</insert>
	
	<select id="listAll" resultType="NoticeVO">
		<![CDATA[
		select * from board_notice 
		where notice_num > 0
		]]>
	</select>
	
	<select id="getNotice" resultMap="noticeMap">
		select notice_num,notice_title,notice_content,notice_regdate,notice_readcnt,notice_ip,notice_img,notice_file,a.admin_num,a.admin_id 
		from board_notice b join admin a
		where notice_num=#{notice_num}
	</select>
	
	<update id="rCountUp">
		update board_notice 
		set notice_readcnt=notice_readcnt+1
		where notice_num=#{notice_num}
	</update>
	
	<select id="noticeCnt" resultType="Integer">
		<![CDATA[
		select count(*) 
		from board_notice
		where notice_num > 0
		]]>
		<include refid="search_condition"></include>
	</select>
	
<!-- 	<select id="pagingNotice" resultType="NoticeVO"> -->
<!-- 		<![CDATA[ -->
<!-- 		select *  -->
<!-- 		from board_notice -->
<!-- 		where notice_num > 0 -->
<!-- 		]]> -->
<!-- 		<include refid="search_condition"></include> -->
<!-- 		order by notice_num desc -->
<!-- 		limit #{pageStart}, #{perPageNum} -->
<!-- 	</select> -->
	
	<select id="pagingNotice" resultMap="noticeMap">
		<![CDATA[
		select notice_num,notice_title,notice_content,notice_regdate,notice_readcnt,notice_ip,notice_img,notice_file,a.admin_num,a.admin_id
		from board_notice b join admin a
		where notice_num > 0
		]]>
		<include refid="search_condition"></include>
		order by notice_num desc
		limit #{pageStart}, #{perPageNum}
	</select>
	
	<update id="updateNotice">
		update board_notice 
		set notice_title=#{notice_title},notice_content=#{notice_content},notice_regdate=now()
		where notice_num=#{notice_num}
	</update>
	
	<delete id="deleteNotice">
		delete from board_notice
		where notice_num=#{notice_num}
	</delete>
	
	<sql id="search_condition">
	<if test="search_type != null">
		<if test="search_type == 'title'.toString()">
			and notice_title like concat('%', #{keyword}, '%')
		</if>
<!-- 		<if test="search_type == 'cate'.toString()"> -->
<!-- 			and notice_cate like concat('%', #{keyword}, '%') -->
<!-- 		</if> -->
<!-- 		<if test="search_type == 'content'.toString()"> -->
<!-- 			and notice_content like concat('%', #{keyword}, '%') -->
<!-- 		</if> -->
	</if>
	</sql>
	
</mapper>
